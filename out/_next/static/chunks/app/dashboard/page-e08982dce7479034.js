(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{579:function(e,s,t){Promise.resolve().then(t.bind(t,7161))},7161:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return X}});var a=t(7437),r=t(2265),l=t(4033),i=t(7658),n=t(3715),d=t(6763),c=t(3023),o=t(6110),m=t(1908),x=t(6672),u=t(5771),h=t(9213),p=t(9311);let j=(0,h.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function f(e){let{className:s,variant:t,...r}=e;return(0,a.jsx)("div",{className:(0,p.cn)(j({variant:t}),s),...r})}var g=t(2376);let v=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(g.fC,{className:(0,p.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",t),...r,ref:s,children:(0,a.jsx)(g.bU,{className:(0,p.cn)("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})})});v.displayName=g.fC.displayName;var N=t(8712),y=t(2549);let b=N.fC,w=N.xz,_=N.h_;N.x8;let S=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(N.aV,{ref:s,className:(0,p.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...r})});S.displayName=N.aV.displayName;let C=r.forwardRef((e,s)=>{let{className:t,children:r,...l}=e;return(0,a.jsxs)(_,{children:[(0,a.jsx)(S,{}),(0,a.jsxs)(N.VY,{ref:s,className:(0,p.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...l,children:[r,(0,a.jsxs)(N.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,a.jsx)(y.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});C.displayName=N.VY.displayName;let k=e=>{let{className:s,...t}=e;return(0,a.jsx)("div",{className:(0,p.cn)("flex flex-col space-y-1.5 text-center sm:text-left",s),...t})};k.displayName="DialogHeader";let O=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(N.Dx,{ref:s,className:(0,p.cn)("text-lg font-semibold leading-none tracking-tight",t),...r})});O.displayName=N.Dx.displayName;let Z=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(N.dk,{ref:s,className:(0,p.cn)("text-sm text-muted-foreground",t),...r})});Z.displayName=N.dk.displayName;var z=t(7579),q=t(9057),P=t(5883),A=t(4322),F=t(3505),R=t(2835),E=t(9883),T=t(5790),M=t(2621);function V(){let{user:e,signOut:s}=(0,i.useAuth)(),{toast:t}=(0,M.pm)(),n=(0,l.useRouter)(),[h,p]=(0,r.useState)(null),[j,g]=(0,r.useState)([]),[N,y]=(0,r.useState)([]),[_,S]=(0,r.useState)(!1),[V,Y]=(0,r.useState)({name:"",description:"",price:"",category:""});(0,r.useEffect)(()=>{D(),I(),L()},[e]);let D=async()=>{if(!e)return;let{data:s}=await d.O.from("vendors").select("*").eq("id",e.id).single();s&&p(s)},I=async()=>{if(!e)return;let{data:s}=await d.O.from("products").select("*").eq("vendor_id",e.id).order("created_at",{ascending:!1});s&&g(s)},L=async()=>{if(!e)return;let{data:s}=await d.O.from("orders").select("*, users!orders_customer_id_fkey(name, mobile)").eq("vendor_id",e.id).order("created_at",{ascending:!1});s&&y(s)},U=async s=>{if(s.preventDefault(),!e)return;let{error:a}=await d.O.from("products").insert({vendor_id:e.id,name:V.name,description:V.description,price:parseFloat(V.price),category:V.category,is_available:!0});a?t({title:"Error",description:"Failed to add product",variant:"destructive"}):(t({title:"Success",description:"Product added successfully"}),S(!1),Y({name:"",description:"",price:"",category:""}),I())},H=async(e,s)=>{let{error:a}=await d.O.from("products").update({is_available:!s}).eq("id",e);a||(I(),t({title:"Success",description:"Product availability updated"}))},Q=async(e,s)=>{let{error:a}=await d.O.from("orders").update({status:s}).eq("id",e);a||(L(),t({title:"Success",description:"Order status updated to ".concat(s)}))},B=async s=>{if(!e)return;let{error:a}=await d.O.from("vendors").update({is_online:s}).eq("id",e.id);a||(p(e=>e?{...e,is_online:s}:null),t({title:"Success",description:"You are now ".concat(s?"online":"offline")}))},G=N.filter(e=>"pending"===e.status).length,J=N.filter(e=>"confirmed"===e.status).length,K=N.filter(e=>"completed"===e.status).length,W=N.filter(e=>"completed"===e.status).reduce((e,s)=>e+s.total_amount,0);return(0,a.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-emerald-50 via-white to-teal-50",children:[(0,a.jsx)("nav",{className:"bg-white border-b sticky top-0 z-10",children:(0,a.jsx)("div",{className:"container mx-auto px-4 py-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-gradient-to-br from-emerald-500 to-teal-600 rounded-lg flex items-center justify-center",children:(0,a.jsx)(q.Z,{className:"w-6 h-6 text-white"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-xl font-bold text-gray-800",children:(null==h?void 0:h.shop_name)||"My Shop"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:null==e?void 0:e.name})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Status:"}),(0,a.jsx)(v,{checked:(null==h?void 0:h.is_online)||!1,onCheckedChange:B}),(0,a.jsx)("span",{className:"text-sm font-medium ".concat((null==h?void 0:h.is_online)?"text-emerald-600":"text-gray-400"),children:(null==h?void 0:h.is_online)?"Online":"Offline"})]}),(0,a.jsxs)(c.z,{variant:"outline",onClick:()=>{s(),n.push("/")},children:[(0,a.jsx)(P.Z,{className:"w-4 h-4 mr-2"}),"Logout"]})]})]})})}),(0,a.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[(0,a.jsx)(o.Zb,{children:(0,a.jsxs)(o.Ol,{className:"pb-3",children:[(0,a.jsx)(o.SZ,{children:"New Orders"}),(0,a.jsx)(o.ll,{className:"text-3xl text-orange-600",children:G})]})}),(0,a.jsx)(o.Zb,{children:(0,a.jsxs)(o.Ol,{className:"pb-3",children:[(0,a.jsx)(o.SZ,{children:"Active Orders"}),(0,a.jsx)(o.ll,{className:"text-3xl text-blue-600",children:J})]})}),(0,a.jsx)(o.Zb,{children:(0,a.jsxs)(o.Ol,{className:"pb-3",children:[(0,a.jsx)(o.SZ,{children:"Completed"}),(0,a.jsx)(o.ll,{className:"text-3xl text-emerald-600",children:K})]})}),(0,a.jsx)(o.Zb,{children:(0,a.jsxs)(o.Ol,{className:"pb-3",children:[(0,a.jsx)(o.SZ,{children:"Total Revenue"}),(0,a.jsxs)(o.ll,{className:"text-3xl text-teal-600",children:["₹",W.toFixed(2)]})]})})]}),(0,a.jsxs)(z.mQ,{defaultValue:"products",className:"w-full",children:[(0,a.jsxs)(z.dr,{className:"grid w-full grid-cols-3 mb-6",children:[(0,a.jsxs)(z.SP,{value:"products",className:"flex items-center gap-2",children:[(0,a.jsx)(A.Z,{className:"w-4 h-4"}),"Products"]}),(0,a.jsxs)(z.SP,{value:"orders",className:"flex items-center gap-2",children:[(0,a.jsx)(F.Z,{className:"w-4 h-4"}),"Orders"]}),(0,a.jsxs)(z.SP,{value:"analytics",className:"flex items-center gap-2",children:[(0,a.jsx)(R.Z,{className:"w-4 h-4"}),"Analytics"]})]}),(0,a.jsx)(z.nU,{value:"products",children:(0,a.jsxs)(o.Zb,{children:[(0,a.jsx)(o.Ol,{children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(o.ll,{children:"My Products"}),(0,a.jsx)(o.SZ,{children:"Manage your product listings"})]}),(0,a.jsxs)(b,{open:_,onOpenChange:S,children:[(0,a.jsx)(w,{asChild:!0,children:(0,a.jsxs)(c.z,{className:"bg-gradient-to-r from-emerald-600 to-teal-600",children:[(0,a.jsx)(E.Z,{className:"w-4 h-4 mr-2"}),"Add Product"]})}),(0,a.jsxs)(C,{children:[(0,a.jsxs)(k,{children:[(0,a.jsx)(O,{children:"Add New Product"}),(0,a.jsx)(Z,{children:"Add a new product to your shop"})]}),(0,a.jsxs)("form",{onSubmit:U,className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(x._,{htmlFor:"product-name",children:"Product Name"}),(0,a.jsx)(m.I,{id:"product-name",value:V.name,onChange:e=>Y({...V,name:e.target.value}),required:!0})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(x._,{htmlFor:"product-price",children:"Price (₹)"}),(0,a.jsx)(m.I,{id:"product-price",type:"number",step:"0.01",value:V.price,onChange:e=>Y({...V,price:e.target.value}),required:!0})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(x._,{htmlFor:"product-category",children:"Category"}),(0,a.jsx)(m.I,{id:"product-category",value:V.category,onChange:e=>Y({...V,category:e.target.value})})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(x._,{htmlFor:"product-description",children:"Description"}),(0,a.jsx)(u.g,{id:"product-description",value:V.description,onChange:e=>Y({...V,description:e.target.value}),rows:3})]}),(0,a.jsx)(c.z,{type:"submit",className:"w-full bg-gradient-to-r from-emerald-600 to-teal-600",children:"Add Product"})]})]})]})]})}),(0,a.jsx)(o.aY,{children:(0,a.jsx)("div",{className:"space-y-4",children:0===j.length?(0,a.jsx)("p",{className:"text-center text-gray-500 py-8",children:"No products yet. Add your first product!"}):j.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h3",{className:"font-semibold text-lg",children:e.name}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:e.description}),(0,a.jsxs)("div",{className:"flex items-center gap-2 mt-2",children:[(0,a.jsxs)("span",{className:"text-emerald-600 font-bold",children:["₹",e.price]}),e.category&&(0,a.jsx)(f,{variant:"secondary",children:e.category})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(v,{checked:e.is_available,onCheckedChange:()=>H(e.id,e.is_available)}),(0,a.jsx)("span",{className:"text-sm",children:e.is_available?"Available":"Unavailable"})]})]},e.id))})})]})}),(0,a.jsx)(z.nU,{value:"orders",children:(0,a.jsxs)(o.Zb,{children:[(0,a.jsxs)(o.Ol,{children:[(0,a.jsx)(o.ll,{children:"Orders"}),(0,a.jsx)(o.SZ,{children:"Manage customer orders"})]}),(0,a.jsx)(o.aY,{children:(0,a.jsx)("div",{className:"space-y-4",children:0===N.length?(0,a.jsx)("p",{className:"text-center text-gray-500 py-8",children:"No orders yet"}):N.map(e=>{var s,t;return(0,a.jsxs)("div",{className:"p-4 border rounded-lg space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"font-semibold",children:["Order #",e.id.slice(0,8)]}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["Customer: ",null===(s=e.users)||void 0===s?void 0:s.name]}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["Mobile: ",null===(t=e.users)||void 0===t?void 0:t.mobile]})]}),(0,a.jsx)(f,{variant:"pending"===e.status?"default":"confirmed"===e.status?"secondary":"completed"===e.status?"default":"destructive",className:"completed"===e.status?"bg-emerald-600":"",children:e.status})]}),(0,a.jsxs)("div",{className:"text-lg font-bold text-emerald-600",children:["₹",e.total_amount]}),"pending"===e.status&&(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(c.z,{size:"sm",onClick:()=>Q(e.id,"confirmed"),className:"bg-blue-600 hover:bg-blue-700",children:"Accept"}),(0,a.jsx)(c.z,{size:"sm",variant:"destructive",onClick:()=>Q(e.id,"cancelled"),children:"Reject"})]}),"confirmed"===e.status&&(0,a.jsx)(c.z,{size:"sm",onClick:()=>Q(e.id,"completed"),className:"bg-emerald-600 hover:bg-emerald-700",children:"Mark as Completed"})]},e.id)})})})]})}),(0,a.jsx)(z.nU,{value:"analytics",children:(0,a.jsxs)(o.Zb,{children:[(0,a.jsxs)(o.Ol,{children:[(0,a.jsx)(o.ll,{children:"Business Analytics"}),(0,a.jsx)(o.SZ,{children:"Track your performance"})]}),(0,a.jsx)(o.aY,{children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(T.Z,{className:"w-8 h-8 text-emerald-600"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Total Products"}),(0,a.jsx)("p",{className:"text-2xl font-bold",children:j.length})]})]})}),(0,a.jsx)("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(F.Z,{className:"w-8 h-8 text-teal-600"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Total Orders"}),(0,a.jsx)("p",{className:"text-2xl font-bold",children:N.length})]})]})}),(0,a.jsx)("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(R.Z,{className:"w-8 h-8 text-cyan-600"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Success Rate"}),(0,a.jsxs)("p",{className:"text-2xl font-bold",children:[N.length>0?(K/N.length*100).toFixed(1):0,"%"]})]})]})})]})})]})})]})]})]})}var Y=t(8094),D=t(268),I=t(6142),L=t(1827),U=t(2176),H=t(2741),Q=t(5331);let B=r.forwardRef((e,s)=>{let{className:t,children:r,...l}=e;return(0,a.jsxs)(Q.fC,{ref:s,className:(0,p.cn)("relative overflow-hidden",t),...l,children:[(0,a.jsx)(Q.l_,{className:"h-full w-full rounded-[inherit]",children:r}),(0,a.jsx)(G,{}),(0,a.jsx)(Q.Ns,{})]})});B.displayName=Q.fC.displayName;let G=r.forwardRef((e,s)=>{let{className:t,orientation:r="vertical",...l}=e;return(0,a.jsx)(Q.gb,{ref:s,orientation:r,className:(0,p.cn)("flex touch-none select-none transition-colors","vertical"===r&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===r&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",t),...l,children:(0,a.jsx)(Q.q4,{className:"relative flex-1 rounded-full bg-border"})})});G.displayName=Q.gb.displayName;var J=t(6020);function K(e){let{recipientId:s,recipientName:t}=e,{user:l}=(0,i.useAuth)(),[n,x]=(0,r.useState)(!1),[u,h]=(0,r.useState)([]),[p,j]=(0,r.useState)(""),[f,g]=(0,r.useState)(!1),v=(0,r.useRef)(null);(0,r.useEffect)(()=>{if(n){N();let e=setInterval(N,3e3);return()=>clearInterval(e)}},[n,s]),(0,r.useEffect)(()=>{v.current&&(v.current.scrollTop=v.current.scrollHeight)},[u]);let N=async()=>{if(!l)return;let{data:e}=await d.O.from("chats").select("*, users!chats_sender_id_fkey(name)").or("and(sender_id.eq.".concat(l.id,",receiver_id.eq.").concat(s,"),and(sender_id.eq.").concat(s,",receiver_id.eq.").concat(l.id,")")).order("created_at",{ascending:!0});if(e){let s=e.map(e=>{var s;return{...e,sender_name:null===(s=e.users)||void 0===s?void 0:s.name}});h(s);let t=e.filter(e=>e.receiver_id===l.id&&!e.is_read).map(e=>e.id);t.length>0&&await d.O.from("chats").update({is_read:!0}).in("id",t)}},b=async e=>{if(e.preventDefault(),!l||!p.trim())return;g(!0);let{error:t}=await d.O.from("chats").insert({sender_id:l.id,receiver_id:s,message:p.trim(),is_read:!1});t||(j(""),N()),g(!1)};return n?(0,a.jsxs)(o.Zb,{className:"fixed bottom-6 right-6 w-96 shadow-2xl",children:[(0,a.jsxs)(o.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-3 bg-gradient-to-r from-emerald-600 to-teal-600 text-white rounded-t-lg",children:[(0,a.jsx)(o.ll,{className:"text-lg",children:t}),(0,a.jsx)(c.z,{variant:"ghost",size:"icon",onClick:()=>x(!1),className:"text-white hover:bg-white/20",children:(0,a.jsx)(y.Z,{className:"w-5 h-5"})})]}),(0,a.jsxs)(o.aY,{className:"p-0",children:[(0,a.jsx)(B,{className:"h-96 p-4",ref:v,children:(0,a.jsx)("div",{className:"space-y-3",children:0===u.length?(0,a.jsx)("p",{className:"text-center text-gray-500 py-8 text-sm",children:"No messages yet. Start the conversation!"}):u.map(e=>(0,a.jsx)("div",{className:"flex ".concat(e.sender_id===(null==l?void 0:l.id)?"justify-end":"justify-start"),children:(0,a.jsxs)("div",{className:"max-w-[75%] rounded-2xl px-4 py-2 ".concat(e.sender_id===(null==l?void 0:l.id)?"bg-gradient-to-r from-emerald-600 to-teal-600 text-white":"bg-gray-100 text-gray-800"),children:[(0,a.jsx)("p",{className:"text-sm break-words",children:e.message}),(0,a.jsx)("p",{className:"text-xs mt-1 ".concat(e.sender_id===(null==l?void 0:l.id)?"text-emerald-100":"text-gray-500"),children:new Date(e.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})},e.id))})}),(0,a.jsxs)("form",{onSubmit:b,className:"p-4 border-t flex gap-2",children:[(0,a.jsx)(m.I,{value:p,onChange:e=>j(e.target.value),placeholder:"Type a message...",disabled:f}),(0,a.jsx)(c.z,{type:"submit",size:"icon",disabled:f||!p.trim(),className:"bg-gradient-to-r from-emerald-600 to-teal-600",children:(0,a.jsx)(J.Z,{className:"w-4 h-4"})})]})]})]}):(0,a.jsx)(c.z,{onClick:()=>x(!0),className:"fixed bottom-6 right-6 rounded-full w-14 h-14 shadow-lg bg-gradient-to-r from-emerald-600 to-teal-600 hover:from-emerald-700 hover:to-teal-700",size:"icon",children:(0,a.jsx)(U.Z,{className:"w-6 h-6"})})}function W(){var e;let{user:s,signOut:t}=(0,i.useAuth)(),{toast:n}=(0,M.pm)(),x=(0,l.useRouter)(),[u,h]=(0,r.useState)([]),[p,j]=(0,r.useState)([]),[g,v]=(0,r.useState)(null),[N,y]=(0,r.useState)([]),[w,_]=(0,r.useState)([]),[S,q]=(0,r.useState)([]),[A,R]=(0,r.useState)(""),[E,T]=(0,r.useState)("all"),[V,Q]=(0,r.useState)(!1),[B,G]=(0,r.useState)(null);(0,r.useEffect)(()=>{J(),W()},[s]),(0,r.useEffect)(()=>{X()},[u,A,E]);let J=async()=>{let{data:e}=await d.O.from("vendors").select("*, users!vendors_id_fkey(*)").eq("is_online",!0);if(e){let s=e.map(e=>({...e,user:e.users}));h(s)}},W=async()=>{if(!s)return;let{data:e}=await d.O.from("orders").select("*, vendors!orders_vendor_id_fkey(shop_name, users!vendors_id_fkey(mobile))").eq("customer_id",s.id).order("created_at",{ascending:!1});e&&_(e)},X=()=>{let e=u;A&&(e=e.filter(e=>{var s;return e.shop_name.toLowerCase().includes(A.toLowerCase())||(null===(s=e.description)||void 0===s?void 0:s.toLowerCase().includes(A.toLowerCase()))})),"all"!==E&&(e=e.filter(e=>e.category===E)),j(e)},$=async e=>{v(e);let{data:s}=await d.O.from("products").select("*").eq("vendor_id",e.id).eq("is_available",!0);s&&y(s),Q(!0)},ee=e=>{let s=S.find(s=>s.product.id===e.id);s?q(S.map(s=>s.product.id===e.id?{...s,quantity:s.quantity+1}:s)):q([...S,{product:e,quantity:1}]),n({title:"Added to cart",description:"".concat(e.name," added to cart")})},es=async()=>{if(!s||!g||0===S.length)return;let e=S.reduce((e,s)=>e+s.product.price*s.quantity,0),t=S.map(e=>({product_id:e.product.id,name:e.product.name,price:e.product.price,quantity:e.quantity})),{error:a}=await d.O.from("orders").insert({vendor_id:g.id,customer_id:s.id,status:"pending",total_amount:e,items:t,delivery_address:s.location_address});a?n({title:"Error",description:"Failed to place order",variant:"destructive"}):(n({title:"Order placed",description:"Your order has been sent to the vendor"}),q([]),Q(!1),W())},et=e=>{var t,a;let r=S.map(e=>"".concat(e.quantity,"x ").concat(e.product.name)).join(", "),l=S.reduce((e,s)=>e+s.product.price*s.quantity,0),i="Hi, I would like to order: ".concat(r,". Total: ₹").concat(l,". From: ").concat(null==s?void 0:s.name," (").concat(null==s?void 0:s.mobile,")");encodeURIComponent(i),n({title:"SMS Order",description:"SMS text copied. Send to: ".concat(null===(t=e.user)||void 0===t?void 0:t.mobile)}),null===(a=navigator.clipboard)||void 0===a||a.writeText(i)};return(0,a.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-emerald-50 via-white to-teal-50",children:[(0,a.jsx)("nav",{className:"bg-white border-b sticky top-0 z-10",children:(0,a.jsx)("div",{className:"container mx-auto px-4 py-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-gradient-to-br from-emerald-500 to-teal-600 rounded-lg flex items-center justify-center",children:(0,a.jsx)(D.Z,{className:"w-6 h-6 text-white"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-xl font-bold text-gray-800",children:"Discover Local Vendors"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:null==s?void 0:s.name})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)(f,{variant:"secondary",className:"text-sm",children:[(0,a.jsx)(F.Z,{className:"w-3 h-3 mr-1"}),S.length," items"]}),(0,a.jsxs)(c.z,{variant:"outline",onClick:()=>{t(),x.push("/")},children:[(0,a.jsx)(P.Z,{className:"w-4 h-4 mr-2"}),"Logout"]})]})]})})}),(0,a.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,a.jsxs)(z.mQ,{defaultValue:"vendors",className:"w-full",children:[(0,a.jsxs)(z.dr,{className:"grid w-full grid-cols-2 mb-6",children:[(0,a.jsxs)(z.SP,{value:"vendors",className:"flex items-center gap-2",children:[(0,a.jsx)(I.Z,{className:"w-4 h-4"}),"Find Vendors"]}),(0,a.jsxs)(z.SP,{value:"orders",className:"flex items-center gap-2",children:[(0,a.jsx)(F.Z,{className:"w-4 h-4"}),"My Orders"]})]}),(0,a.jsx)(z.nU,{value:"vendors",children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)(o.Zb,{children:[(0,a.jsxs)(o.Ol,{children:[(0,a.jsx)(o.ll,{children:"Search Vendors"}),(0,a.jsx)(o.SZ,{children:"Find local entrepreneurs near you"})]}),(0,a.jsx)(o.aY,{children:(0,a.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(L.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),(0,a.jsx)(m.I,{placeholder:"Search by shop name or description...",value:A,onChange:e=>R(e.target.value),className:"pl-10"})]})}),(0,a.jsx)("div",{className:"w-full md:w-48",children:(0,a.jsxs)(Y.Ph,{value:E,onValueChange:T,children:[(0,a.jsx)(Y.i4,{children:(0,a.jsx)(Y.ki,{placeholder:"All Categories"})}),(0,a.jsx)(Y.Bw,{children:["all","Grocery","Food","Taxi","Tailor","Plumber","Electrician","Other"].map(e=>(0,a.jsx)(Y.Ql,{value:e,children:"all"===e?"All Categories":e},e))})]})})]})})]}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:0===p.length?(0,a.jsxs)("div",{className:"col-span-full text-center py-12",children:[(0,a.jsx)(I.Z,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-500",children:"No vendors found"})]}):p.map(e=>(0,a.jsxs)(o.Zb,{className:"hover:shadow-lg transition-all cursor-pointer",onClick:()=>$(e),children:[(0,a.jsx)(o.Ol,{children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)(o.ll,{className:"text-lg",children:e.shop_name}),(0,a.jsx)(f,{variant:"secondary",className:"mt-2",children:e.category})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1 text-yellow-500",children:[(0,a.jsx)("span",{className:"text-sm font-semibold",children:e.rating.toFixed(1)}),(0,a.jsx)("span",{children:"⭐"})]})]})}),(0,a.jsxs)(o.aY,{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-3 line-clamp-2",children:e.description||"No description available"}),(0,a.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1 text-emerald-600",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-emerald-600 rounded-full"}),(0,a.jsx)("span",{children:"Online"})]}),(0,a.jsxs)("span",{className:"text-gray-500",children:[e.total_orders," orders"]})]})]})]},e.id))})]})}),(0,a.jsx)(z.nU,{value:"orders",children:(0,a.jsxs)(o.Zb,{children:[(0,a.jsxs)(o.Ol,{children:[(0,a.jsx)(o.ll,{children:"My Orders"}),(0,a.jsx)(o.SZ,{children:"Track your order history"})]}),(0,a.jsx)(o.aY,{children:(0,a.jsx)("div",{className:"space-y-4",children:0===w.length?(0,a.jsx)("p",{className:"text-center text-gray-500 py-8",children:"No orders yet"}):w.map(e=>{var s;return(0,a.jsxs)("div",{className:"p-4 border rounded-lg space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-semibold",children:null===(s=e.vendors)||void 0===s?void 0:s.shop_name}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["Order #",e.id.slice(0,8)]}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:new Date(e.created_at).toLocaleDateString()})]}),(0,a.jsx)(f,{variant:"pending"===e.status?"default":"confirmed"===e.status?"secondary":"completed"===e.status?"default":"destructive",className:"completed"===e.status?"bg-emerald-600":"",children:e.status})]}),(0,a.jsxs)("div",{className:"text-lg font-bold text-emerald-600",children:["₹",e.total_amount]}),(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:[e.items.length," item(s)"]})]},e.id)})})})]})})]})}),(0,a.jsx)(b,{open:V,onOpenChange:Q,children:(0,a.jsxs)(C,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,a.jsxs)(k,{children:[(0,a.jsx)(O,{children:null==g?void 0:g.shop_name}),(0,a.jsx)(Z,{children:null==g?void 0:g.description})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(f,{variant:"secondary",children:null==g?void 0:g.category}),(0,a.jsxs)("span",{className:"text-sm text-gray-600",children:["⭐ ",null==g?void 0:g.rating.toFixed(1)]})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(c.z,{variant:"outline",size:"sm",onClick:()=>g&&G({id:g.id,name:g.shop_name}),children:[(0,a.jsx)(U.Z,{className:"w-4 h-4 mr-2"}),"Chat"]}),(null==g?void 0:null===(e=g.user)||void 0===e?void 0:e.mobile)&&(0,a.jsxs)(c.z,{variant:"outline",size:"sm",onClick:()=>et(g),disabled:0===S.length,children:[(0,a.jsx)(H.Z,{className:"w-4 h-4 mr-2"}),"SMS Order"]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold mb-3",children:"Products"}),(0,a.jsx)("div",{className:"space-y-3",children:0===N.length?(0,a.jsx)("p",{className:"text-center text-gray-500 py-4",children:"No products available"}):N.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"font-medium",children:e.name}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:e.description}),(0,a.jsxs)("p",{className:"text-emerald-600 font-bold mt-1",children:["₹",e.price]})]}),(0,a.jsx)(c.z,{size:"sm",onClick:()=>ee(e),className:"bg-gradient-to-r from-emerald-600 to-teal-600",children:"Add to Cart"})]},e.id))})]}),S.length>0&&(0,a.jsxs)("div",{className:"border-t pt-4 space-y-3",children:[(0,a.jsxs)("h3",{className:"font-semibold",children:["Cart (",S.length," items)"]}),S.map((e,s)=>(0,a.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,a.jsxs)("span",{children:[e.quantity,"x ",e.product.name]}),(0,a.jsxs)("span",{className:"font-semibold",children:["₹",(e.product.price*e.quantity).toFixed(2)]})]},s)),(0,a.jsxs)("div",{className:"flex items-center justify-between pt-3 border-t font-bold text-lg",children:[(0,a.jsx)("span",{children:"Total:"}),(0,a.jsxs)("span",{className:"text-emerald-600",children:["₹",S.reduce((e,s)=>e+s.product.price*s.quantity,0).toFixed(2)]})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(c.z,{onClick:es,className:"flex-1 bg-gradient-to-r from-emerald-600 to-teal-600",children:"Place Order"}),(0,a.jsx)(c.z,{variant:"outline",onClick:()=>q([]),children:"Clear Cart"})]})]})]})]})}),B&&(0,a.jsx)(K,{recipientId:B.id,recipientName:B.name})]})}function X(){let{user:e,loading:s}=(0,i.useAuth)(),t=(0,l.useRouter)(),[d,c]=(0,r.useState)(!1);return((0,r.useEffect)(()=>{c(!0)},[]),(0,r.useEffect)(()=>{s||e||!d||t.push("/login")},[e,s,t,d]),s||!d)?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,a.jsx)(n.Z,{className:"w-8 h-8 animate-spin text-emerald-600"})}):e?"vendor"===e.role?(0,a.jsx)(V,{}):(0,a.jsx)(W,{}):null}}},function(e){e.O(0,[257,237,499,350,516,584,971,864,744],function(){return e(e.s=579)}),_N_E=e.O()}]);